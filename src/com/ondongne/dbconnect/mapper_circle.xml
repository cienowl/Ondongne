<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="circle">
	<insert id="circleInsert" parameterType="com.ondongne.dto.DataTransferCircle">
		insert into circle(email,pictures, post_date, title, region, zipcode, address, address_detail, event_date, end_date, gender, description, tags, mem_number) values (#{email},#{pictures},NOW(), #{title},#{region},#{zipcode},#{address},#{address_detail},#{event_date},#{end_date},#{gender},#{description},'tag',#{mem_number});
	</insert>
	
	<select id="getCirclePostAll" resultType="com.ondongne.dto.DataTransferCircle">
		select * from circle;
	</select>
	
	<select id="getJoinCircle" parameterType="String" resultType="com.ondongne.dto.DataTransferCircle">
		select id, title, email, event_date from circle where id IN(select join_postid from helper_circle where join_email=#{loginEmail});
	</select>
	
	<update id="circleUpdate" parameterType="com.ondongne.dto.DataTransferCircle">
		update circle set title=#{title}, region=#{region}, zipcode=#{zipcode}, address=#{address}, address_detail=#{address_detail}, event_date=#{event_date}, end_date=#{end_date}, gender=#{gender}, description=#{description}, mem_number=#{mem_number} where id=#{id};
	</update>
	
	<delete id="circleDelete" parameterType="com.ondongne.dto.DataTransferCircle">
		delete from circle where id=#{id} AND email=#{email};
	</delete>
	
	<select id="getPostCircle" parameterType="String" resultType="com.ondongne.dto.DataTransferCircle">
		select * from circle where email=#{loginEmail};
	</select>
	
	<select id="getSearchCircle" parameterType="String" resultType="com.ondongne.dto.DataTransferCircle">
		select * from circle WHERE title LIKE CONCAT('%',#{value},'%') OR description LIKE CONCAT('%',#{value},'%') OR region LIKE CONCAT('%',#{value},'%') OR email LIKE CONCAT('%',#{value},'%') OR address LIKE CONCAT('%',#{value},'%');
	</select>
	
</mapper>