<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sell">

	<insert id="insertSellPost" parameterType="com.ondongne.dto.DataTransferSell">
		insert into sell(
			email,
			id,
			title,
			price,
			region,
			description,
			is_parcel,
			is_active,
			pictures,
			tags,
			post_date
		)
		values(
			#{email},
			default,
			#{title},
			#{price},
			#{region},
			#{description},
			#{is_parcel},
			#{is_active},
			#{pictures},
			'tags',
			now()
		)
	</insert>
	
	<select id="selectSellPostAll" resultType="com.ondongne.dto.DataTransferSell">
		select * from sell order by post_date desc
	</select>
	
	<select id="selectSellPostAllPaging" resultType="com.ondongne.dto.DataTransferSell" parameterType="int">
		select * from sell order by post_date desc limit 12 offset #{pageOffset}
	</select>
	
	<select id="getJoinSell" resultType="com.ondongne.dto.DataTransferSell" parameterType="String">
		select id, email, title, price from sell where id in(select join_postid from helper_sell where join_email=#{loginEmail})
	</select>
	
	<select id="selectSellByEmail" resultType="com.ondongne.dto.DataTransferSell" parameterType="String">
		select * from sell where email=#{email}
	</select>
	
	<select id="searchSellList" resultType="com.ondongne.dto.DataTransferSell" parameterType="String">
		select * from sell WHERE title LIKE CONCAT('%',#{searchWord},'%') OR description LIKE CONCAT('%',#{searchWord},'%') or region LIKE CONCAT('%',#{searchWord},'%') order by post_date desc
	</select>	
	
	<select id="searchSellListPaging" resultType="com.ondongne.dto.DataTransferSell" parameterType="com.ondongne.dto.SearchSellBean">
		select * from sell WHERE title LIKE CONCAT('%',#{searchWord},'%') OR description LIKE CONCAT('%',#{searchWord},'%') or region LIKE CONCAT('%',#{searchWord},'%') order by post_date desc limit 12 offset #{page}
	</select>
	
	<delete id="deleteSellPost" parameterType="com.ondongne.dto.DataTransferSell">
		delete from sell where id=#{id}
	</delete>
	
	<update id="updateSellPost" parameterType="com.ondongne.dto.DataTransferSell">
		update sell set email=#{email}, title=#{title},	price=#{price}, region=#{region}, description=#{description}, is_parcel=#{is_parcel}, is_active=#{is_active}, pictures=#{pictures}, tags='tags', post_date=now() where id=#{id}
	</update>
	
	<update id="updateSellPostExPic" parameterType="com.ondongne.dto.DataTransferSell">
		update sell set email=#{email}, title=#{title},	price=#{price}, region=#{region}, description=#{description}, is_parcel=#{is_parcel}, is_active=#{is_active}, tags='tags', post_date=now() where id=#{id}
	</update>

</mapper>

