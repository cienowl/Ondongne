<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hotplace">

	<insert id="insertHotplace" parameterType="com.ondongne.dto.HotplaceBean">
		insert into hotplace(admin_id, id, title, pictures, zipcode, address, address_detail, region, description, postdate, lastupdate)
		values(#{admin_id}, default, #{title},	#{pictures}, #{zipcode}, #{address}, #{address_detail},	#{region}, #{description}, now(), now())
	</insert>

	<update id="updateHotplace" parameterType="com.ondongne.dto.HotplaceBean">
		update hotplace set
			admin_id=#{admin_id},
			title=#{title},
			pictures=#{pictures},
			region=#{region},
			zipcode=#{zipcode},
			address=#{address},
			address_detail=#{address_detail},
			description=#{description},
			lastupdate=now()
		where id=#{id}
	</update>
	
	<update id="updateHotplaceExPic" parameterType="com.ondongne.dto.HotplaceBean">
		update hotplace set
			admin_id=#{admin_id},
			title=#{title},
			region=#{region},
			zipcode=#{zipcode},
			address=#{address},
			address_detail=#{address_detail},
			description=#{description},
			lastupdate=now()
		where id=#{id}
	</update>
	
	<select id="searchHotplaceListPaging" resultType="com.ondongne.dto.HotplaceBean" parameterType="com.ondongne.dto.SearchHotplaceBean">
		select * from hotplace WHERE title LIKE CONCAT('%',#{searchWord},'%') OR description LIKE CONCAT('%',#{searchWord},'%') or region LIKE CONCAT('%',#{searchWord},'%') order by postdate desc limit 12 offset #{page}
	</select>

	<select id="selectHotplacePostAllPaging" resultType="com.ondongne.dto.HotplaceBean" parameterType="int">
		select * from hotplace order by postdate desc limit 12 offset #{pageOffset}
	</select>


	<delete id="deleteHotplace" parameterType="String">
		delete from hotplace where id=#{id};
	</delete>

	<select id="selectHotplaceListDesc" resultType="com.ondongne.dto.HotplaceBean">
		select * from hotplace order by id desc;
	</select>
	
	<select id="listCard" resultType="com.ondongne.dto.HotplaceBean">
		select * from hotplace;
	</select>
	
	<insert id="scrapHotplace"
		parameterType="com.ondongne.dto.ScrapPlaceBean">
		insert into helper_hotplace(scrap_email, scrap_id) values (#{scrap_email},
		#{scrap_id});
	</insert>
	
	<select id="showScrap" parameterType="String" resultType="com.ondongne.dto.HotplaceBean">
		select * from hotplace where id IN(select scrap_id from helper_hotplace where scrap_email=#{userID});
	</select>
	
	<delete id="cancelScrapPlace" parameterType="com.ondongne.dto.ScrapPlaceBean">
		delete from helper_hotplace where scrap_id=#{scrap_id} AND scrap_email=#{scrap_email};
	</delete>	

	<select id="selectContent" resultType="com.ondongne.dto.HotplaceBean">
		select * from hotplace where id = #{id};
	</select>

	<insert id="simpleSignUp"
		parameterType="com.ondongne.dto.DataTransferUsers">
		insert into users(email, password) values (#{email},
		#{password});
	</insert>
	
	<select id="relatedPlace"
		resultType="com.ondongne.dto.HotplaceBean" parameterType="String">
		select * from hotplace where region like CONCAT('%',#{value},'%');
	</select>
	
	<update id="placePostCount" parameterType="int">
		update hotplace a, hotplace b set a.post_count = b.post_count+1 where a.id=b.id AND a.id=#{postid};
	</update>
	
	<select id="getPlacePostCount" parameterType="int" resultType="int">
		select post_count from hotplace WHERE id=#{postid};
	</select>
	
	<select id="searchHotplaceList" resultType="com.ondongne.dto.HotplaceBean" parameterType="String">
		select * from hotplace 
		WHERE id LIKE CONCAT('%',#{searchWord},'%') 
		OR title LIKE CONCAT('%',#{searchWord},'%') 
		OR zipcode LIKE CONCAT('%',#{searchWord},'%') 
		OR address LIKE CONCAT('%',#{searchWord},'%') 
		OR address_detail LIKE CONCAT('%',#{searchWord},'%') 
		OR region LIKE CONCAT('%',#{searchWord},'%') 
		OR description LIKE CONCAT('%',#{searchWord},'%') 
		OR postdate LIKE CONCAT('%',#{searchWord},'%') order by postdate desc;
	</select>
</mapper>